<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of computeSpatialParameters</title>
  <meta name="keywords" content="computeSpatialParameters">
  <meta name="description" content="%">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003-2019 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">fun</a> &gt; <a href="index.html">parameterCalculation</a> &gt; computeSpatialParameters.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for fun/parameterCalculation&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>computeSpatialParameters
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>%</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [out] = computeSpatialParameters(strideEvents,markerData,angleData,s) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment">%</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="getKinematicData.html" class="code" title="function [rotatedMarkerData,sAnkFwd,fAnkFwd,sAnk2D,fAnk2D,sAngle,fAngle,direction,hipPosSHS,sAnk_fromAvgHip,fAnk_fromAvgHip]=getKinematicData(eventTimes,markerData,angleData,s)">getKinematicData</a>	getKinematicData   loads marker data sampled only at time of gait events</li><li><a href="getKinematicDataAbs.html" class="code" title="function [rotatedMarkerData,sAnkFwd,fAnkFwd,sAnk2D,fAnk2D,sAngle,fAngle,direction,hipPosSHS,sAnk_fromAvgHip,fAnk_fromAvgHip]=getKinematicDataAbs(eventTimes,markerData,angleData,s)">getKinematicDataAbs</a>	getKinematicData   loads marker data sampled only at time of gait events</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="calcParameters.html" class="code" title="function out = calcParameters(trialData,subData,eventClass,initEventSide,parameterClasses)">calcParameters</a>	out = calcParameters(trialData,subData,eventClass,initEventSide)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [out] = computeSpatialParameters(strideEvents,markerData,angleData,s)</a>
0002 <span class="comment">%%</span>
0003 
0004 timeSHS=strideEvents.tSHS;
0005 timeFTO=strideEvents.tFTO;
0006 timeFHS=strideEvents.tFHS;
0007 timeSTO=strideEvents.tSTO;
0008 timeSHS2=strideEvents.tSHS2;
0009 timeFTO2=strideEvents.tFTO2;
0010 timeFHS2=strideEvents.tFHS2;
0011 timeSTO2=strideEvents.tSTO2;
0012 eventTimes=[timeSHS timeFTO timeFHS timeSTO timeSHS2 timeFTO2 timeFHS2 timeSTO2];
0013 SHS=1; FTO=2; FHS=3; STO=4; SHS2=5; FTO2=6; FHS2=7; STO2=8; <span class="comment">%numbers correspond to column of eventTimes matrix</span>
0014 <span class="comment">%% Labels and descriptions:</span>
0015 aux={<span class="string">'direction'</span>,               <span class="string">'-1 if walking towards window, 1 if walking towards door (implemented for OG bias removal and coordinate rotation)'</span>;<span class="keyword">...</span>
0016     <span class="string">'hipPos'</span>,                   <span class="string">'mid hip position at SHS. NOT: average hip pos of stride (should be nearly constant on treadmill - implemented for OG bias removal) (in mm)'</span>;<span class="keyword">...</span>
0017     <span class="string">'stepLengthSlow'</span>,           <span class="string">'distance between ankle markers at SHS2 (in mm)'</span>;<span class="keyword">...</span>
0018     <span class="string">'stepLengthFast'</span>,           <span class="string">'distance between ankle markers at FHS (in mm)'</span>;<span class="keyword">...</span>
0019     <span class="string">'takeOffLengthSlow'</span>,        <span class="string">'sAnkle position, with respect to fAnkle at STO (in mm)'</span>;<span class="keyword">...</span>
0020     <span class="string">'takeOffLengthFast'</span>,        <span class="string">'fAnkle position with respect to sAnkle at FTO (in mm)'</span>;<span class="keyword">...</span>
0021     <span class="string">'alphaSlow'</span>,                <span class="string">'ankle placement of slow leg at SHS2 (realtive to avg hip marker) (in mm)'</span>;<span class="keyword">...</span>
0022     <span class="string">'alphaTemp'</span>,                <span class="string">'ankle placement of slow leg at SHS (realtive to avg hip marker) (in mm)'</span>;<span class="keyword">...</span>
0023     <span class="string">'alphaFast'</span>,                <span class="string">'ankle placement of fast leg at FHS (in mm)'</span>;<span class="keyword">...</span>
0024     <span class="string">'alphaDiff'</span>,                 <span class="string">'alphaFast-alphaSlow'</span>;<span class="keyword">...</span>
0025     <span class="string">'alphaAsym'</span>,                 <span class="string">'(alphaFast-alphaSlow)/(SLf+SLs)'</span>;<span class="keyword">...</span>
0026     <span class="string">'alphaAngSlow'</span>,             <span class="string">'slow leg angle (hip to ankle with respect to vertical) at SHS2 (in deg)'</span>;<span class="keyword">...</span>
0027     <span class="string">'alphaAngFast'</span>,             <span class="string">'fast leg angle at FHS (in deg)'</span>;<span class="keyword">...</span>
0028     <span class="string">'betaSlow'</span>,                 <span class="string">'ankle placement of slow leg at STO (relative avg hip marker) (in mm)'</span>;<span class="keyword">...</span>
0029     <span class="string">'betaFast'</span>,                 <span class="string">'ankle placement of fast leg at FTO2 (in mm)'</span>;<span class="keyword">...</span>
0030     <span class="string">'XSlow'</span>,                    <span class="string">'ankle postion of the slow leg @FHS (in mm)'</span>;<span class="keyword">...</span>
0031     <span class="string">'XFast'</span>,                    <span class="string">'ankle position of Fast leg @SHS (in mm)'</span>;<span class="keyword">...</span>
0032     <span class="string">'Xdiff'</span>,                     <span class="string">'Xdiff Fast - Slow'</span>;<span class="keyword">...</span>
0033     <span class="string">'Xasym'</span>,                     <span class="string">'Xdiff/(SLf+SLs)'</span>;<span class="keyword">...</span>
0034     <span class="string">'RFastPos'</span>,                 <span class="string">'Ratio of FTO/FHS'</span>;<span class="keyword">...</span>
0035     <span class="string">'RSloWPos'</span>,                 <span class="string">'Ratio of STO/SHS'</span>;<span class="keyword">...</span>
0036     <span class="string">'RFastPosSHS'</span>,              <span class="string">'Ratio of fank@SHS/FHS'</span>;<span class="keyword">...</span>
0037     <span class="string">'RSlowPosFHS'</span>,              <span class="string">'Ratio of sank@FHS/SHS'</span>;<span class="keyword">...</span>
0038     <span class="string">'betaAngSlow'</span>,              <span class="string">'slow leg angle at STO (in deg)'</span>;<span class="keyword">...</span>
0039     <span class="string">'betaAngFast'</span>,              <span class="string">'fast leg angle at FTO (in deg)'</span>;<span class="keyword">...</span>
0040     <span class="string">'stanceRangeSlow'</span>,          <span class="string">'alphaSlow - betaSlow (i.e. total distance covered by slow ankle relative to hip during stance) (in mm)'</span>;<span class="keyword">...</span>
0041     <span class="string">'stanceRangeFast'</span>,          <span class="string">'alphaFast - betaFast (in mm)'</span>;<span class="keyword">...</span>
0042     <span class="string">'stanceRangeAngSlow'</span>,       <span class="string">'|alphaAngSlow| + |betaAngSlow| (i.t total angle swept out by slow leg during stance) (in deg)'</span>;<span class="keyword">...</span>
0043     <span class="string">'stanceRangeAngFast'</span>,       <span class="string">'|alphaAngFast| + |betaAngFast| (in deg)'</span>;<span class="keyword">...</span>
0044     <span class="string">'swingRangeSlow'</span>,           <span class="string">'total distance covered by slow ankle marker realtive to hip from STO to SHS2 (in mm)'</span>;<span class="keyword">...</span>
0045     <span class="string">'swingRangeFast'</span>,           <span class="string">'total distance covered by fast ankle marker realtive to hip from FTO to FHS (in mm)'</span>;<span class="keyword">...</span>
0046     <span class="string">'omegaSlow'</span>,                <span class="string">'angle between legs at SHS2 (in deg)'</span>;<span class="keyword">...</span>
0047     <span class="string">'omegaFast'</span>,                <span class="string">'angle between legs at FHS (in deg)'</span>;<span class="keyword">...</span>
0048     <span class="string">'alphaRatioSlow'</span>,           <span class="string">'alphaSlow/(alphaSlow+alphaFast)'</span>;<span class="keyword">...</span>
0049     <span class="string">'alphaRatioFast'</span>,           <span class="string">'alphaFast/(alphaSlow+alphaFast)'</span>;<span class="keyword">...</span>
0050     <span class="string">'alphaDeltaSlow'</span>,           <span class="string">'slow leg angle at SHS2 - fast leg angle at FHS (in deg)'</span>;<span class="keyword">...</span>
0051     <span class="string">'alphaDeltaFast'</span>,           <span class="string">'fast leg angle at FHS - slow leg angle at SHS (in deg)'</span>;<span class="keyword">...</span>
0052     <span class="string">'stepLengthDiff'</span>,           <span class="string">'stepLengthFast-stepLengthSlow (in mm)'</span>;<span class="keyword">...</span>
0053     <span class="string">'stepLengthDiff2D'</span>,         <span class="string">'two-dimensional version of stepLengthDiff (in mm)'</span>;<span class="keyword">...</span>
0054     <span class="string">'stepLengthAsym'</span>,           <span class="string">'Step length difference (fast-slow), divided by sum'</span>;<span class="keyword">...</span>
0055     <span class="string">'stepLengthAsym2D'</span>,         <span class="string">'two-dimensional step length difference (fast-slow), divided by sum'</span>;<span class="keyword">...</span>
0056     <span class="string">'angularSpreadDiff'</span>,        <span class="string">'omegaFast-omegaSlow (in deg)'</span>;<span class="keyword">...</span>
0057     <span class="string">'angularSpreadAsym'</span>,        <span class="string">'angular spread difference / sum'</span>;<span class="keyword">...</span>
0058     <span class="string">'Sout'</span>,                     <span class="string">'Alpha difference (fast-slow), divided by alpha sum'</span>;<span class="keyword">...</span>
0059     <span class="string">'Serror'</span>,                   <span class="string">'alphaRatioSlow-alphaRatioFast'</span>;<span class="keyword">...</span>
0060     <span class="string">'SerrorOld'</span>,                <span class="string">'alphaRatioFast/alphaRatioSlow'</span>;<span class="keyword">...</span>
0061     <span class="string">'Sgoal'</span>,                    <span class="string">'(stanceRangeAngFast-stanceRangeAngSlow)/stanceRangeAngFast'</span>;<span class="keyword">...</span>
0062     <span class="string">'angleOfOscillationAsym'</span>,   <span class="string">'(alhpaAngFast+betaAngFast)/2-(alphaAngSlow+betaAngSlow)/2'</span>;<span class="keyword">...</span>
0063     <span class="string">'phaseShift'</span>,               <span class="string">'parcent of stride that one angle trace is shifted with respect to the other for max correlation'</span>;<span class="keyword">...</span>
0064     <span class="string">'phaseShiftPos'</span>,            <span class="string">'same as phaseShift, but uses ankle pos trace instead of angles'</span>;<span class="keyword">...</span>
0065     <span class="string">'spatialContribution'</span>,      <span class="string">'DIFFERENCE of relative position of ankle markers at ipsi-lateral HS (i.e. slow ankle at SHS minus fast ankle at FHS), it ends up being = sAnk(SHS2)+sAnk(SHS)-2*fAnk(FHS)'</span>;<span class="keyword">...</span>
0066     <span class="string">'stepTimeContribution'</span>,     <span class="string">'Average ankle speed relative to mid-hip, times step time difference'</span>;<span class="keyword">...</span>
0067     <span class="string">'velocityContribution'</span>,     <span class="string">'Average step time times ankle speed (relative to hip) difference'</span>;<span class="keyword">...</span>
0068     <span class="string">'netContribution'</span>,          <span class="string">'Sum of the previous three'</span>;<span class="keyword">...</span>
0069     <span class="string">'spatialContributionP'</span>,      <span class="string">'Same as spatial contribution, in absolute (lab) reference frame (no Hip involved)'</span>;<span class="keyword">...</span>
0070     <span class="string">'stepTimeContributionP'</span>,     <span class="string">'Same as stepTime, in absolute frame'</span>;<span class="keyword">...</span>
0071     <span class="string">'velocityContributionP'</span>,     <span class="string">'Same as velocityContribution, in absolute frame'</span>;<span class="keyword">...</span>
0072     <span class="string">'netContributionP'</span>,          <span class="string">'Sum of the previous three (should make it identical to netContribution, which is equal to stepLengthAsym)'</span>;<span class="keyword">...</span>
0073     <span class="string">'spatialContributionPNorm'</span>,      <span class="string">'Same as spatial contribution, in absolute (lab) reference frame (no Hip involved)'</span>;<span class="keyword">...</span>
0074     <span class="string">'stepTimeContributionPNorm'</span>,     <span class="string">'Same as stepTime, in absolute frame'</span>;<span class="keyword">...</span>
0075     <span class="string">'velocityContributionPNorm'</span>,     <span class="string">'Same as velocityContribution, in absolute frame'</span>;<span class="keyword">...</span>
0076     <span class="string">'netContributionPNorm'</span>,          <span class="string">'Sum of the previous three (should make it identical to netContribution, which is equal to stepLengthAsym)'</span>;<span class="keyword">...</span>
0077     <span class="string">'spatialContributionPNorm2'</span>,      <span class="string">'Same as spatial contribution Pnorm, corrected for OG walking (using rotated markerdata)'</span>;<span class="keyword">...</span>
0078     <span class="string">'stepTimeContributionPNorm2'</span>,     <span class="string">'Same as stepTime contribution Pnorm, corrected for OG walking (using rotated markerdata)'</span>;<span class="keyword">...</span>
0079     <span class="string">'velocityContributionPNorm2'</span>,     <span class="string">'Same as velocityContribution Pnorm, corrected for OG walking (using rotated markerdata)'</span>;<span class="keyword">...</span>
0080     <span class="string">'netContributionPNorm2'</span>,          <span class="string">'Sum of the previous three'</span>;<span class="keyword">...</span>
0081     <span class="string">'spatialContributionAlt'</span>,     <span class="string">'Spatial contribution divided by stride time, to get velocity units instead of length units'</span>;<span class="keyword">...</span>
0082     <span class="string">'stepTimeContributionAlt'</span>,    <span class="string">'Step time contribution divided by stride time, to get velocity units instead of length units'</span>;<span class="keyword">...</span>
0083     <span class="string">'velocityContributionAlt'</span>,    <span class="string">'Velocity contribution divided by stride time, to get velocity units instead of length units'</span>;<span class="keyword">...</span>
0084     <span class="string">'netContributionAlt'</span>,          <span class="string">'Net contribution divided by cadence, to get velocity units instead of length units'</span>;<span class="keyword">...</span>
0085     <span class="string">'spatialContributionAltRatio'</span>,     <span class="string">'Spatial contribution divided by cadence times sum of ankle velocities during stance, so that we get dimensionless (comparable to *Norm2) '</span>;<span class="keyword">...</span>
0086     <span class="string">'stepTimeContributionAltRatio'</span>,    <span class="string">'Step time contribution divided by cadence times sum of ankle velocities during stance'</span>;<span class="keyword">...</span>
0087     <span class="string">'velocityContributionAltRatio'</span>,    <span class="string">'Velocity contribution divided by cadence times sum of ankle velocities during stance, which should be a function of RATIO only'</span>;<span class="keyword">...</span>
0088     <span class="string">'netContributionAltRatio'</span>,          <span class="string">'Net contribution divided by cadence times sum of ankle velocities during stance'</span>;<span class="keyword">...</span>
0089     <span class="string">'spatialContributionNorm2'</span>,    <span class="string">'spatialContribution/(stepLengthFast+stepLengthSlow)'</span>;<span class="keyword">...</span>
0090     <span class="string">'stepTimeContributionNorm2'</span>,    <span class="string">'stepTimeContribution/(stepLengthFast+stepLengthSlow)'</span>;<span class="keyword">...</span>
0091     <span class="string">'velocityContributionNorm2'</span>,    <span class="string">'velContribution/(stepLengthFast+stepLengthSlow)'</span>;<span class="keyword">...</span>
0092     <span class="string">'netContributionNorm2'</span>,     <span class="string">'netContribution/(stepLengthFast+stepLengthSlow). With this normalization, netContributionNorm2 shoudl be IDENTICAL to stepLengthAsym'</span>;<span class="keyword">...</span>
0093     <span class="string">'stepTimeIdealT'</span>,           <span class="string">'Ideal stepTimeContribution value (normalized to sum of step lengths) based on Tgoal parameter'</span>;<span class="keyword">...</span>
0094     <span class="string">'spatialIdealT'</span>,            <span class="string">'Ideal spatialContribution value (normalized to sum of step length) equivalent to -(velocityContributionNorm2+stepTimeIdealT)'</span>;<span class="keyword">...</span>
0095     <span class="string">'stepTimeErrorT'</span>,           <span class="string">'Difference between stepTimeContributionNorm2 and stepTimeIdealT'</span>;<span class="keyword">...</span>
0096     <span class="string">'spatialErrorT'</span>,            <span class="string">'Difference between spatialContributionNorm2 and spatialIdealT'</span>;<span class="keyword">...</span>
0097     <span class="string">'stepTimeIdealS'</span>,           <span class="string">'Ideal stepTimeContribution value (normalized to sum of step lengths) based on Sgoal parameter'</span>;<span class="keyword">...</span>
0098     <span class="string">'spatialIdealS'</span>,            <span class="string">'Ideal spatialContribution value (normalized to sum of step length) equivalent to -(velocityContributionNorm2+stepTimeIdealS)'</span>;<span class="keyword">...</span>
0099     <span class="string">'stepTimeErrorS'</span>,           <span class="string">'Difference between stepTimeContributionNorm2 and stepTimeIdealS'</span>;<span class="keyword">...</span>
0100     <span class="string">'spatialErrorS'</span>,            <span class="string">'Difference between spatialContributionNorm2 and spatialIdealS'</span>;<span class="keyword">...</span>
0101     <span class="string">'equivalentSpeed'</span>,          <span class="string">'Relative speed of hip to feet, '</span>;<span class="keyword">...</span>
0102     <span class="string">'singleStanceSpeedSlowAbs'</span>,    <span class="string">'Absolute speed of slow toe during contralateral swing'</span>;<span class="keyword">...</span>
0103     <span class="string">'singleStanceSpeedFastAbs'</span>,    <span class="string">'Absolute speed of fast toe during contralateral swing'</span>;<span class="keyword">...</span>
0104     <span class="string">'singleStanceSpeedSlowAbsANK'</span>,    <span class="string">'Absolute speed of slow ankle during contralateral swing'</span>;<span class="keyword">...</span>
0105     <span class="string">'singleStanceSpeedFastAbsANK'</span>,    <span class="string">'Absolute speed of fast ankle during contralateral swing'</span>;<span class="keyword">...</span>
0106     <span class="string">'singleStanceSpeedDiffAbsAnk'</span>,   <span class="string">'Absolute speed of difference between fast and slow ankle during contralateral swing'</span>;<span class="keyword">...</span>
0107     <span class="string">'stepSpeedSlow'</span>,            <span class="string">'Ankle relative to hip, from iHS to cHS'</span>;<span class="keyword">...</span>
0108     <span class="string">'stepSpeedFast'</span>,            <span class="string">'Ankle relative to hip, from iHS to cHS'</span>;<span class="keyword">...</span>
0109     <span class="string">'stepSpeedAvg'</span>,            <span class="string">'Average speed of the ankle relative to the hip between slow and fast leg'</span>;<span class="keyword">...</span>
0110     <span class="string">'stanceSpeedSlow'</span>,          <span class="string">'Ankle relative to hip, during ipsilateral stance'</span>;<span class="keyword">...</span>
0111     <span class="string">'stanceSpeedFast'</span>,          <span class="string">'Ankle relative to hip, during ipsilateral stance'</span>;<span class="keyword">...</span>
0112     <span class="string">'alphaTemp_fromAvgHip'</span>,     <span class="string">'Ankle placement of slow leg at SHS (realtive to avg hip marker and avg hip postion during time) (in mm)'</span>;<span class="keyword">...</span>
0113     <span class="string">'alphaFast_fromAvgHip'</span>,     <span class="string">'Ankle placement of fast leg at FHS (realtive to avg hip marker and avg hip postion during time) (in mm)'</span>;<span class="keyword">...</span>
0114     <span class="string">'alphaSlow_fromAvgHip'</span>,     <span class="string">'Ankle placement of slow leg at SHS2 (realtive to avg hip marker and avg hip postion during time) (in mm)'</span>;<span class="keyword">...</span>
0115     <span class="string">'xTemp_fromAvgHip'</span>,         <span class="string">'Ankle placement of fast leg at SHS (realtive to avg hip marker and avg hip postion during time) (in mm)'</span>;<span class="keyword">...</span>
0116     <span class="string">'xFast_fromAvgHip'</span>,         <span class="string">'Ankle placement of slow leg at FHS (realtive to avg hip marker and avg hip postion during time) (in mm)'</span>;<span class="keyword">...</span>
0117     <span class="string">'xSlow_fromAvgHip'</span>,         <span class="string">'Ankle placement of fast leg at SHS2 (realtive to avg hip marker and avg hip postion during time) (in mm)'</span>;<span class="keyword">...</span>
0118     <span class="string">'velocitySlow'</span>              <span class="string">' Velocity of  slow foot relative to hip, should be close to actual belt speed in TM trials'</span>;<span class="keyword">...</span>
0119     <span class="string">'velocityFast'</span>              <span class="string">' Velocity of  fast foot relative to hip, should be close to actual belt speed in TM trials'</span>;<span class="keyword">...</span>
0120     <span class="string">'velocityAltContribution'</span>   <span class="string">'Alternative velocity contribution, which subtracts belt speeds as estimated by singleStanceSpeedFastAbs and SlowAbs (in mm)'</span>;<span class="keyword">...</span>
0121     <span class="string">'velocityAltContributionAlt'</span> <span class="string">'velocityAltContribution, normalized by stride time'</span>;<span class="keyword">...</span>
0122     <span class="string">'velocityAltContributionNorm2'</span> <span class="string">'velocityAltContribution, normalized by sum of step lengths'</span>;<span class="keyword">...</span>
0123     <span class="string">'velocityAltContributionP'</span>  <span class="string">'velocityAltContribtuion using absolute lab reference (mm)'</span>;<span class="keyword">...</span>
0124     <span class="string">'velocityAltContributionPNorm'</span> <span class="string">'velocityAltContributionP, normalized to sum of step lengths'</span>;<span class="keyword">...</span>
0125     <span class="string">'singleStanceSpeedSlow'</span>,     <span class="string">'Single stance speed for ankle relative to the hip for the slow leg during contralateral swing'</span>;<span class="keyword">...</span>
0126     <span class="string">'singleStanceSpeedFast'</span>,     <span class="string">'Single stance speed for ankle relative to the hip for the fast leg during contralateral swing'</span>;<span class="keyword">...</span>
0127     <span class="string">'singleStanceSpeedAvg'</span>,     <span class="string">'Single stance speed for ankle relative to the hip averaged accross the legs'</span>;<span class="keyword">...</span>
0128     <span class="string">'singleStanceSpeedDiff'</span>,    <span class="string">'Single stance speed difference, fast single stance speed minus slow single stance speed (ankle relative to the hip)'</span>;<span class="keyword">...</span>
0129 <span class="comment">%    'avgRotation',            'Angle that the coordinates were rotated by';...</span>
0130    }; 
0131 
0132 paramLabels=aux(:,1);
0133 description=aux(:,2);
0134 
0135 <span class="comment">%% Sanity check &amp; correction: look for markers at (0,0,0) and set data to NaN</span>
0136 [dd,ll]=markerData.getOrientedData;
0137 dd=permute(dd,[1,3,2]);
0138 ee=all(dd==0,2);
0139 <span class="keyword">if</span> any(ee(:))
0140     msg=[<span class="string">'Markers were reconstructed at the origin. Setting to NaN for spatial parameter computation.'</span>];
0141     
0142     <span class="keyword">for</span> i=1:size(ee,3)
0143         <span class="keyword">if</span> any(ee(:,1,i)) &amp;&amp; sum(ee(:,1,i))*markerData.sampPeriod &gt; 1
0144             msg=[msg <span class="string">' '</span> ll{i} <span class="string">' was at origin for '</span> num2str(sum(ee(:,1,i))*markerData.sampPeriod) <span class="string">'s.'</span>];
0145         <span class="keyword">end</span>
0146     <span class="keyword">end</span>
0147     warning(msg)
0148 <span class="keyword">end</span>
0149 
0150 ee=repmat(ee,1,3,1);
0151 
0152 markerData.Data(ee)=NaN;
0153 dd=markerData.getOrientedData;
0154 dd=permute(dd,[1,3,2]);
0155 ee=all(dd==0,2);
0156 <span class="keyword">if</span> any(ee(:))
0157     error(<span class="string">'Setting markers at the origin to NaN did not work'</span>)
0158 <span class="keyword">end</span>
0159 <span class="comment">%% Get rotated data</span>
0160 [rotatedMarkerData,sAnkFwd,fAnkFwd,sAnk2D,fAnk2D,sAngle,fAngle,direction,hipPos,sAnk_fromAvgHip,fAnk_fromAvgHip]=<a href="getKinematicData.html" class="code" title="function [rotatedMarkerData,sAnkFwd,fAnkFwd,sAnk2D,fAnk2D,sAngle,fAngle,direction,hipPosSHS,sAnk_fromAvgHip,fAnk_fromAvgHip]=getKinematicData(eventTimes,markerData,angleData,s)">getKinematicData</a>(eventTimes,markerData,angleData,s);
0161 [rotatedMarkerDataAbs,sAnkFwdAbs,fAnkFwdAbs,sAnk2DAbs,fAnk2DAbs,sAngleAbs,fAngleAbs,directionAbs,hipPosSHSAbs,sAnk_fromAvgHipAbs,fAnk_fromAvgHipAbs]=<a href="getKinematicDataAbs.html" class="code" title="function [rotatedMarkerData,sAnkFwd,fAnkFwd,sAnk2D,fAnk2D,sAngle,fAngle,direction,hipPosSHS,sAnk_fromAvgHip,fAnk_fromAvgHip]=getKinematicDataAbs(eventTimes,markerData,angleData,s)">getKinematicDataAbs</a>(eventTimes,markerData,angleData,s);
0162 
0163 <span class="comment">%% Intralimb</span>
0164 <span class="keyword">if</span> strcmp(s,<span class="string">'L'</span>)
0165     f=<span class="string">'R'</span>;
0166 <span class="keyword">elseif</span> strcmp(s,<span class="string">'R'</span>)
0167     f=<span class="string">'L'</span>;
0168 <span class="keyword">else</span>
0169     error();
0170 <span class="keyword">end</span> 
0171 
0172 <span class="comment">%step lengths (1D)</span>
0173 stepLengthSlow=sAnkFwd(:,SHS2)-fAnkFwd(:,SHS2); <span class="comment">%If sAnkFwd and fAnkFwd are measured with respect to the same reference, this is the same as just subtracting the marker positions</span>
0174 stepLengthFast=fAnkFwd(:,FHS)-sAnkFwd(:,FHS);
0175 takeOffLengthSlow=sAnkFwd(:,STO)-fAnkFwd(:,STO);
0176 takeOffLengthFast=fAnkFwd(:,FTO)-sAnkFwd(:,FTO);
0177 
0178 <span class="comment">%ALTERNATIVE COMPUTATION WAY: doesn't use HIP, so HIP loss is not an issue</span>
0179 <span class="comment">%(HIP value doesn't affect tis computation, but since it is used as</span>
0180 <span class="comment">%reference, it generates NaN downstream if absent:</span>
0181 <span class="comment">%Because we are not using HIP, walking direction is determined through Left</span>
0182 <span class="comment">%to Right ankle vector.</span>
0183 stepLengthSlow=sAnkFwdAbs(:,SHS2)-fAnkFwdAbs(:,SHS2);
0184 stepLengthFast=fAnkFwdAbs(:,FHS)-sAnkFwdAbs(:,FHS);
0185 takeOffLengthSlow=sAnkFwdAbs(:,STO)-fAnkFwdAbs(:,STO);
0186 takeOffLengthFast=fAnkFwdAbs(:,FTO)-sAnkFwdAbs(:,FTO);
0187 
0188 
0189 <span class="comment">%step length (2D) Express w.r.t the hip -- don't save, for now.</span>
0190 stepLengthSlow2D=sqrt(sum((sAnk2D(:,SHS2,:)-fAnk2D(:,SHS2,:)).^2,3));
0191 stepLengthFast2D=sqrt(sum((fAnk2D(:,FHS,:)-sAnk2D(:,FHS,:)).^2,3));
0192 
0193 <span class="comment">%Spatial parameters - in millimeters</span>
0194 
0195 <span class="comment">%alpha (positive portion of interlimb angle at HS)</span>
0196 alphaSlow=sAnkFwd(:,SHS2);
0197 alphaTemp=sAnkFwd(:,SHS);
0198 alphaFast=fAnkFwd(:,FHS);
0199 alphaDiff=alphaFast-alphaSlow;
0200 <span class="comment">%beta (negative portion of interlimb angle at TO)</span>
0201 betaSlow=sAnkFwd(:,STO);
0202 betaFast=fAnkFwd(:,FTO2);
0203 <span class="comment">%position of the ankle marker at contra lateral at HS</span>
0204 XSlow=sAnkFwd(:,FHS);
0205 XFast=fAnkFwd(:,SHS2);
0206 Xdiff=XFast-XSlow;
0207 <span class="comment">%stance range (subtract since beta is a negative value)</span>
0208 stanceRangeSlow=alphaTemp-betaSlow;
0209 stanceRangeFast=alphaFast-betaFast;
0210 <span class="comment">%swing range</span>
0211 swingRangeSlow=sAnkFwd(:,SHS2)-sAnkFwd(:,STO);
0212 swingRangeFast=fAnkFwd(:,FHS)-fAnkFwd(:,FTO);
0213 swingRangeSlowAbs=sAnkFwdAbs(:,SHS2)-sAnkFwdAbs(:,STO);
0214 swingRangeFastAbs=fAnkFwdAbs(:,FHS)-fAnkFwdAbs(:,FTO);
0215 
0216 <span class="comment">%Ratio TO./HS</span>
0217 RFastPos=abs(betaFast./alphaFast);
0218 RSloWPos=abs(betaSlow./alphaTemp); 
0219 
0220 <span class="comment">%Ratio ankle position @HS of contralateral leg./HS</span>
0221 RFastPosSHS=abs(XFast./alphaFast);
0222 RSlowPosFHS=abs(XSlow./alphaTemp);
0223 
0224 
0225 <span class="comment">%Spatial parameters - in degrees</span>
0226 
0227 <span class="comment">%alpha (positive portion of interlimb angle at HS)</span>
0228 alphaAngSlow=sAngle(:,SHS2);
0229 alphaAngTemp=sAngle(:,SHS);
0230 alphaAngFast=fAngle(:,FHS);
0231 <span class="comment">%beta (negative portion of interlimb angle at TO)</span>
0232 betaAngSlow=sAngle(:,STO);
0233 betaAngFast=fAngle(:,FTO2);
0234 <span class="comment">%range (alpha+beta)</span>
0235 stanceRangeAngSlow=alphaAngTemp-betaAngSlow;
0236 stanceRangeAngFast=alphaAngFast-betaAngFast;
0237 <span class="comment">%interlimb spread at HS</span>
0238 omegaSlow=abs(sAngle(:,SHS2)-fAngle(:,SHS2));
0239 omegaFast=abs(fAngle(:,FHS)-sAngle(:,FHS));
0240 <span class="comment">%alpha ratios</span>
0241 alphaRatioSlow=alphaSlow./(alphaSlow+alphaFast);
0242 alphaRatioFast=alphaFast./(alphaSlow+alphaFast);
0243 <span class="comment">%delta alphas</span>
0244 alphaDeltaSlow=sAngle(:,SHS2)-fAngle(:,FHS); <span class="comment">%same as alphaAngSlow-alphaAngFast</span>
0245 alphaDeltaFast=fAngle(:,FHS)-sAngle(:,SHS);
0246 
0247 <span class="comment">%%</span>
0248 alphaTemp_fromAvgHip = (-1)*sAnk_fromAvgHip(:,SHS); <span class="comment">% Multiply by -1 to correct for direction alpha has to be positive</span>
0249 alphaFast_fromAvgHip = (-1)*fAnk_fromAvgHip(:,FHS);
0250 alphaSlow_fromAvgHip = (-1)*sAnk_fromAvgHip(:,SHS2);
0251 
0252 xTemp_fromAvgHip = (-1)*fAnk_fromAvgHip(:,SHS);
0253 xSlow_fromAvgHip = (-1)*sAnk_fromAvgHip(:,FHS);
0254 xFast_fromAvgHip = (-1)*fAnk_fromAvgHip(:,SHS2);
0255 
0256 <span class="comment">%% Interlimb</span>
0257 
0258 stepLengthDiff=stepLengthFast-stepLengthSlow;
0259 stepLengthAsym=stepLengthDiff./(stepLengthFast+stepLengthSlow);
0260 stepLengthDiff2D=stepLengthFast2D-stepLengthSlow2D;
0261 stepLengthAsym2D=stepLengthDiff2D./(stepLengthFast2D+stepLengthSlow2D);
0262 angularSpreadDiff=omegaFast-omegaSlow;
0263 angularSpreadAsym=angularSpreadDiff./(omegaFast+omegaSlow);
0264 Sout=(alphaFast-alphaSlow)./(alphaFast+alphaSlow);
0265 Serror=alphaRatioSlow-alphaRatioFast;
0266 SerrorOld=alphaRatioFast./alphaRatioSlow;
0267 Sgoal=(stanceRangeFast-stanceRangeSlow)./(stanceRangeFast+stanceRangeSlow);
0268 centerSlow=(alphaAngSlow+betaAngSlow)./2;
0269 centerFast=(alphaAngFast+betaAngFast)./2;
0270 angleOfOscillationAsym=(centerFast-centerSlow);            
0271 Xasym=Xdiff./(stepLengthFast+stepLengthSlow);
0272 alphaAsym=alphaDiff./(stepLengthFast+stepLengthSlow);
0273 <span class="comment">%phase shift (using angles)</span>
0274 <span class="comment">% slowlimb=sAngle(indSHS:indSHS2);</span>
0275 <span class="comment">% fastlimb=fAngle(indSHS:indSHS2);</span>
0276 <span class="comment">% slowlimb=slowlimb-mean(slowlimb);</span>
0277 <span class="comment">% fastlimb=fastlimb-mean(fastlimb);</span>
0278 <span class="comment">% % Circular correlation</span>
0279 <span class="comment">% phaseShift=circCorr(slowlimb,fastlimb);</span>
0280 <span class="comment">%</span>
0281 <span class="comment">% %phase shift (using marker locations)</span>
0282 <span class="comment">% slowlimb=sAnkPos(indSHS:indSHS2);</span>
0283 <span class="comment">% fastlimb=fAnkPos(indSHS:indSHS2);</span>
0284 <span class="comment">% slowlimb=slowlimb-mean(slowlimb);</span>
0285 <span class="comment">% fastlimb=fastlimb-mean(fastlimb);</span>
0286 <span class="comment">% % Circular correlation</span>
0287 <span class="comment">% phaseShiftPos=circCorr(slowlimb,fastlimb);</span>
0288 T=length(timeSHS);
0289 phaseShift=nan(T,1);
0290 phaseShiftPos=nan(T,1);
0291 <span class="keyword">for</span> i=1:T
0292     <span class="keyword">if</span> ~isnan(timeSHS(i)) &amp;&amp; ~isnan(timeSHS2(i))
0293         <span class="keyword">if</span> ~isempty(angleData)
0294             sLimb=angleData.split(timeSHS(i),timeSHS2(i)).getDataAsVector({[s,<span class="string">'Limb'</span>]});
0295             fLimb=angleData.split(timeSHS(i),timeSHS2(i)).getDataAsVector({[f,<span class="string">'Limb'</span>]});
0296             <span class="keyword">if</span> ~isempty(sLimb) &amp;&amp; ~isempty(fLimb)
0297                 phaseShift(i)=circCorr(sLimb,fLimb);
0298             <span class="keyword">end</span>
0299         <span class="keyword">end</span>
0300         Pos=rotatedMarkerData.split(timeSHS(i),timeSHS2(i)).getOrientedData({[s,<span class="string">'ANK'</span>],[f,<span class="string">'ANK'</span>]});    
0301         <span class="keyword">if</span> ~isempty(Pos)
0302             phaseShiftPos(i)=circCorr(Pos(:,1,2),Pos(:,2,2)); <span class="comment">%Using y components only, which is equivalent to sAnkFwd</span>
0303         <span class="keyword">end</span>
0304     <span class="keyword">end</span>
0305 <span class="keyword">end</span>
0306 
0307 
0308 <span class="comment">%% Contribution Calculations</span>
0309 
0310 <span class="comment">% Compute spatial contribution (1D)</span>
0311 spatialFast=fAnkFwd(:,FHS) - sAnkFwd(:,SHS);
0312 spatialSlow=sAnkFwd(:,SHS2) - fAnkFwd(:,FHS);    
0313 
0314 <span class="comment">% Compute temporal contributions</span>
0315 ts=(timeFHS-timeSHS); 
0316 tf=(timeSHS2-timeFHS); 
0317 difft=ts-tf;
0318 
0319 dispSlow=abs(sAnkFwd(:,FHS)-sAnkFwd(:,SHS)); <span class="comment">%FIXME: This SHOULD NOT use an abs(), if the sign is supposed to be the opposite one, just make it so. Abs() makes it murky to know what this quantity means.</span>
0320 dispFast=abs(fAnkFwd(:,SHS2)-fAnkFwd(:,FHS));
0321 
0322 velocitySlow=dispSlow./ts; <span class="comment">% Velocity of foot relative to hip, should be close to actual belt speed in TM trials</span>
0323 velocityFast=dispFast./tf;            
0324 avgVel=mean([velocitySlow velocityFast],2);           
0325 avgStepTime=mean([ts tf],2); <span class="comment">%This is half strideTimeSlow!</span>
0326 
0327 spatialContribution=spatialFast-spatialSlow;            
0328 stepTimeContribution=avgVel.*difft;            
0329 velocityContribution=avgStepTime.*(velocitySlow-velocityFast);            
0330 netContribution=spatialContribution+stepTimeContribution+velocityContribution; 
0331 
0332 <span class="comment">%Alternative and normalized contributions</span>
0333 strideTimeSlow=timeSHS2-timeSHS; <span class="comment">%Exactly the same definition as in computeTemporalParameters</span>
0334 spatialContributionAlt=spatialContribution./strideTimeSlow;
0335 stepTimeContributionAlt=stepTimeContribution./strideTimeSlow;
0336 velocityContributionAlt=velocityContribution./strideTimeSlow;
0337 netContributionAlt=netContribution./strideTimeSlow;
0338 
0339 <span class="comment">%spatialContributionNorm=spatialContributionAlt./equivalentSpeed;</span>
0340 <span class="comment">%stepTimeContributionNorm=stepTimeContributionAlt./equivalentSpeed;</span>
0341 <span class="comment">%velocityContributionNorm=velocityContributionAlt./equivalentSpeed;</span>
0342 <span class="comment">%netContributionNorm=netContributionAlt./equivalentSpeed;</span>
0343 
0344 spatialContributionAltRatio=spatialContributionAlt./(velocitySlow+velocityFast);
0345 stepTimeContributionAltRatio=stepTimeContributionAlt./(velocitySlow+velocityFast);
0346 velocityContributionAltRatio=velocityContributionAlt./(velocitySlow+velocityFast);
0347 netContributionAltRatio=netContributionAlt./(velocitySlow+velocityFast);
0348 
0349 Dist=stepLengthFast+stepLengthSlow;
0350 spatialContributionNorm2=spatialContribution./Dist;
0351 stepTimeContributionNorm2=stepTimeContribution./Dist;
0352 velocityContributionNorm2=velocityContribution./Dist;
0353 netContributionNorm2=netContribution./Dist;
0354 
0355 aux=markerData.getDataAsTS({[f <span class="string">'ANKy'</span>],[ s <span class="string">'ANKy'</span>]}).getSample(eventTimes,<span class="string">'closest'</span>); <span class="comment">%Will be Nx8x2</span>
0356 spatialContributionP=-(2*aux(:,FHS,1) -aux(:,SHS2,2)-aux(:,SHS,2));
0357 vf=(aux(:,SHS2,1)-aux(:,FHS,1))./tf;
0358 vs=(aux(:,FHS,2)-aux(:,SHS,2))./ts;
0359 stepTimeContributionP= .5*(vf + vs).*(ts-tf);
0360 velocityContributionP= .5*(vs-vf).*(tf+ts);
0361 netContributionP=spatialContributionP+stepTimeContributionP+velocityContributionP;
0362 
0363 spatialContributionPNorm=spatialContributionP./Dist;
0364 stepTimeContributionPNorm=stepTimeContributionP./Dist;
0365 velocityContributionPNorm=velocityContributionP./Dist;
0366 netContributionPNorm=netContributionP./Dist;
0367 
0368 <span class="comment">%Added by Marcela 06/01/2021</span>
0369 
0370 dispS=abs(sAnkFwd(:,FHS)-sAnkFwd(:,FTO)); <span class="comment">%displacement for single stance %FIXME: This SHOULD NOT use an abs(), if the sign is supposed to be the opposite one, just make it so. Abs() makes it murky to know what this quantity means.</span>
0371 dispF=abs(fAnkFwd(:,SHS2)-fAnkFwd(:,STO));
0372 
0373 singleStanceSpeedSlow=dispS./(timeFHS-timeFTO);
0374 singleStanceSpeedFast=dispF./(timeSHS2-timeSTO);
0375 
0376 singleStanceSpeedAvg=mean([singleStanceSpeedSlow singleStanceSpeedFast],2); <span class="comment">%I dont want to do nan mean because it will not be good for the split conditions</span>
0377 singleStanceSpeedDiff=singleStanceSpeedFast- singleStanceSpeedSlow;
0378 
0379 <span class="comment">%Contributions in absolute frame using rotated markerdata</span>
0380 <span class="comment">% modified by Digna April 2018 to use rotated markerdata. This allows to</span>
0381 <span class="comment">% use these values for OG trials</span>
0382 aux=-1*rotatedMarkerDataAbs.getDataAsTS({[f <span class="string">'ANKy'</span>],[ s <span class="string">'ANKy'</span>]}).getSample(eventTimes,<span class="string">'closest'</span>); <span class="comment">%Will be Nx8x2</span>
0383 spatialContributionP2=-(2*aux(:,FHS,1) -aux(:,SHS2,2)-aux(:,SHS,2));
0384 vf2=abs((aux(:,SHS2,1)-aux(:,FHS,1)))./tf;
0385 vs2=abs((aux(:,FHS,2)-aux(:,SHS,2)))./ts;
0386 stepTimeContributionP2= .5*(vf2 + vs2).*(ts-tf);
0387 velocityContributionP2= .5*(vs2-vf2).*(tf+ts);
0388 netContributionP2=spatialContributionP2+stepTimeContributionP2+velocityContributionP2;
0389 
0390 spatialContributionPNorm2=spatialContributionP2./Dist;
0391 stepTimeContributionPNorm2=stepTimeContributionP2./Dist;
0392 velocityContributionPNorm2=velocityContributionP2./Dist;
0393 netContributionPNorm2=netContributionP2./Dist;
0394 
0395 <span class="comment">% Contribution error values</span>
0396 
0397 <span class="comment">%from T goal</span>
0398 stanceTimeSlow=timeSTO-timeSHS;
0399 stanceTimeFast=timeFTO2-timeFHS;
0400 stepTimeIdealT=((velocitySlow+velocityFast)./2).*(stanceTimeSlow-stanceTimeFast)./Dist;
0401 spatialIdealT=-(velocityContributionNorm2+stepTimeIdealT);
0402 stepTimeErrorT=stepTimeIdealT-stepTimeContributionNorm2;
0403 spatialErrorT=spatialIdealT-spatialContributionNorm2;
0404 
0405 <span class="comment">%From S goal</span>
0406 rangeSlow=alphaSlow-betaSlow;
0407 rangeFast=alphaFast-betaFast;
0408 spatialIdealS=(2*(alphaFast+alphaSlow)./Dist).*((rangeFast-rangeSlow)./(rangeFast+rangeSlow));
0409 stepTimeIdealS=(-velocityContributionNorm2)-spatialIdealS;
0410 spatialErrorS=spatialIdealS-spatialContributionNorm2;
0411 stepTimeErrorS=stepTimeIdealS-stepTimeContributionNorm2;
0412 
0413 
0414 
0415 <span class="comment">%% Speed calculations</span>
0416 equivalentSpeed=(dispSlow+dispFast)./(ts+tf); <span class="comment">%= (ts./tf+ts)*dispSlow./ts + (tf./tf+ts)*dispFast./tf = (ts./tf+ts)*vs + (tf./tf+ts)*vf = weighted average of ipsilateral speeds: if subjects spend much more time over one foot than the other, this might not be close to the arithmetic average</span>
0417 
0418 <span class="comment">% sStanceIdxs=indFTO:indFHS;</span>
0419 <span class="comment">% fStanceIdxs=indSTO:indSHS2;</span>
0420 <span class="comment">% singleStanceSpeedSlowAbs=prctile(f_events*diff(sToe(sStanceIdxs,2)),70);</span>
0421 <span class="comment">% singleStanceSpeedFastAbs=prctile(f_events*diff(fToe(fStanceIdxs,2)),70);</span>
0422 T=length(timeSHS);
0423 singleStanceSpeedSlowAbs=nan(T,1);
0424 singleStanceSpeedFastAbs=nan(T,1);
0425 sToeAbsVel=markerData.getDataAsOTS({[s <span class="string">'TOE'</span>]}).derivate;
0426 fToeAbsVel=markerData.getDataAsOTS({[f <span class="string">'TOE'</span>]}).derivate;
0427 <span class="keyword">for</span> i=1:T
0428     <span class="keyword">if</span> ~isnan(timeFTO(i)) &amp;&amp; ~isnan(timeFHS(i)) <span class="comment">%Case that the event is missing</span>
0429         sToePartial=sToeAbsVel.split(timeFTO(i),timeFHS(i)).getOrientedData();
0430         singleStanceSpeedSlowAbs(i)=prctile(sToePartial(:,1,2),70);
0431     <span class="keyword">end</span>
0432     <span class="keyword">if</span> ~isnan(timeSTO(i)) &amp;&amp; ~isnan(timeSHS2(i))
0433         fToePartial=fToeAbsVel.split(timeSTO(i),timeSHS2(i)).getOrientedData();
0434         singleStanceSpeedFastAbs(i)=prctile(fToePartial(:,1,2),70);
0435     <span class="keyword">end</span>
0436 <span class="keyword">end</span>
0437 
0438 
0439 singleStanceSpeedSlowAbsANK=nan(T,1);
0440 singleStanceSpeedFastAbsANK=nan(T,1);
0441 sToeAbsVelANK=markerData.getDataAsOTS({[s <span class="string">'ANK'</span>]}).derivate;
0442 fToeAbsVelANK=markerData.getDataAsOTS({[f <span class="string">'ANK'</span>]}).derivate;
0443 <span class="keyword">for</span> i=1:T
0444     <span class="keyword">if</span> ~isnan(timeFTO(i)) &amp;&amp; ~isnan(timeFHS(i)) <span class="comment">%Case that the event is missing</span>
0445         sToePartialANK=sToeAbsVelANK.split(timeFTO(i),timeFHS(i)).getOrientedData();
0446         singleStanceSpeedSlowAbsANK(i)=prctile(sToePartialANK(:,1,2),70);
0447     <span class="keyword">end</span>
0448     <span class="keyword">if</span> ~isnan(timeSTO(i)) &amp;&amp; ~isnan(timeSHS2(i))
0449         fToePartialANK=fToeAbsVelANK.split(timeSTO(i),timeSHS2(i)).getOrientedData();
0450         singleStanceSpeedFastAbsANK(i)=prctile(fToePartialANK(:,1,2),70);
0451     <span class="keyword">end</span>
0452 <span class="keyword">end</span>
0453 
0454 singleStanceSpeedDiffAbsAnk=singleStanceSpeedFastAbsANK-singleStanceSpeedSlowAbsANK;
0455 
0456 stanceSpeedSlow=abs(sAnkFwd(:,STO)-sAnkFwd(:,SHS))./(timeSTO-timeSHS); <span class="comment">%Ankle relative to hip, during ipsilateral stance</span>
0457 stanceSpeedFast=abs(fAnkFwd(:,FTO2)-fAnkFwd(:,FHS))./(timeFTO2-timeFHS); <span class="comment">%Ankle relative to hip, during ipsilateral stance</span>
0458 
0459 <span class="comment">%stepSpeed - should be the same as velocity calculation for contributions</span>
0460 <span class="comment">%above.</span>
0461 stepSpeedSlow=dispSlow./ts; <span class="comment">%Ankle relative to hip, from iHS to cHS</span>
0462 stepSpeedFast=dispFast./tf; <span class="comment">%Ankle relative to hip, from iHS to cHS</span>
0463 
0464 stepSpeedAvg = nanmean([stepSpeedSlow stepSpeedFast],2);
0465 
0466 <span class="comment">%Rotate coordinates back to original so there are not</span>
0467 <span class="comment">%disconinuities within next stride</span>
0468 <span class="comment">% rotationMatrix = [cosd(-avgRotation) -sind(-avgRotation) 0; sind(-avgRotation) cosd(-avgRotation) 0; 0 0 1];</span>
0469 <span class="comment">% sAnk(indSHS:indFTO2,:) = (rotationMatrix*sAnk(indSHS:indFTO2,:)')';</span>
0470 <span class="comment">% fAnk(indSHS:indFTO2,:) = (rotationMatrix*fAnk(indSHS:indFTO2,:)')';</span>
0471 <span class="comment">% sHip(indSHS:indFTO2,:) = (rotationMatrix*sHip(indSHS:indFTO2,:)')';</span>
0472 <span class="comment">% fHip(indSHS:indFTO2,:) = (rotationMatrix*fHip(indSHS:indFTO2,:)')';</span>
0473 
0474 <span class="comment">%% Other contributions</span>
0475 velocityAltContribution=velocityContribution -(singleStanceSpeedSlowAbs-singleStanceSpeedFastAbs).*avgStepTime;
0476 velocityAltContributionAlt=velocityAltContribution./strideTimeSlow;
0477 velocityAltContributionNorm2=velocityAltContribution./Dist;
0478 velocityAltContributionP=velocityContributionP -(singleStanceSpeedSlowAbs-singleStanceSpeedFastAbs).*(tf+ts)/2;
0479 velocityAltContributionPNorm=velocityAltContributionP./Dist;
0480 
0481 <span class="comment">%% Assign parameters to data matrix</span>
0482 data=nan(length(timeSHS),length(paramLabels));
0483 <span class="keyword">for</span> i=1:length(paramLabels)
0484     eval([<span class="string">'data(:,i)='</span> paramLabels{i} <span class="string">';'</span>])
0485 <span class="keyword">end</span>
0486 
0487 <span class="comment">%% Create parameterSeries</span>
0488 out=parameterSeries(data,paramLabels,[],description);        
0489 
0490 <span class="keyword">end</span>
0491</pre></div>
<hr><address>Generated on Tue 16-Apr-2024 13:38:31 by <strong><a href="https://github.com/gllmflndn/m2html">m2html</a></strong> &copy; 2003-2022</address>
</body>
</html>